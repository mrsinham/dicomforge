# Interactive Wizard Design

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:subagent-driven-development to implement this plan task-by-task.

**Goal:** Add an interactive wizard mode to dicomforge that guides users through DICOM generation with explanations, smart defaults, and configuration file support.

**Architecture:** TUI wizard using bubbletea/huh/lipgloss with sequential flow through hierarchical configuration (Global â†’ Patient â†’ Study â†’ Series). Help panel displays contextual explanations. Configuration can be saved/loaded as YAML.

**Tech Stack:** Go 1.24+, charmbracelet/bubbletea, charmbracelet/huh, charmbracelet/lipgloss, gopkg.in/yaml.v3

---

## Entry Points

```bash
dicomforge wizard                    # Dedicated subcommand
dicomforge --interactive             # Flag on main command
dicomforge -i                        # Shortcut

dicomforge --config <file.yaml>      # Generate from config file
dicomforge wizard --from <file.yaml> # Edit existing config in wizard
```

---

## Architecture

```
cmd/dicomforge/
â”œâ”€â”€ main.go                    # Entry point, detect --interactive or wizard
â””â”€â”€ wizard/
    â”œâ”€â”€ wizard.go              # Main orchestrator
    â”œâ”€â”€ state.go               # WizardState struct and methods
    â”œâ”€â”€ config.go              # YAML config load/save
    â”œâ”€â”€ screens/
    â”‚   â”œâ”€â”€ global.go          # Global config screen (modality, size, output)
    â”‚   â”œâ”€â”€ patient.go         # Patient config screen
    â”‚   â”œâ”€â”€ study.go           # Study config screen
    â”‚   â”œâ”€â”€ series.go          # Series config screen
    â”‚   â”œâ”€â”€ summary.go         # Final summary screen
    â”‚   â””â”€â”€ progress.go        # Generation progress screen
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ help_panel.go      # Contextual help panel
    â”‚   â”œâ”€â”€ tree_view.go       # Structure tree visualization
    â”‚   â””â”€â”€ form_layout.go     # Form + help panel layout
    â””â”€â”€ help/
        â””â”€â”€ descriptions.go    # Help text for each field
```

---

## Data Structures

### WizardState

```go
type WizardState struct {
    Global   GlobalConfig
    Patients []PatientConfig
}

type GlobalConfig struct {
    Modality      string // MR, CT, CR, DX, US, MG
    TotalImages   int
    TotalSize     string // e.g., "500MB"
    OutputDir     string
    Seed          int64
    NumPatients   int
    StudiesPerPatient int
    SeriesPerStudy    int
}

type PatientConfig struct {
    Name      string // DICOM format: FAMILY^Given
    ID        string
    BirthDate string // YYYY-MM-DD
    Sex       string // M, F, O
    Studies   []StudyConfig
}

type StudyConfig struct {
    Description        string
    Date               string
    AccessionNumber    string
    Institution        string
    Department         string
    BodyPart           string
    Priority           string // HIGH, ROUTINE, LOW
    ReferringPhysician string
    CustomTags         map[string]string
    Series             []SeriesConfig
}

type SeriesConfig struct {
    Description  string
    Protocol     string
    Orientation  string // AXIAL, SAGITTAL, CORONAL
    ImageCount   int
    CustomTags   map[string]string
}
```

### YAML Config Format

```yaml
# dicomforge configuration
# Generated by wizard on 2026-01-25

global:
  modality: MR
  total_images: 50
  total_size: 500MB
  output: ./brain_study
  seed: 42

patients:
  - name: DUPONT^Marie
    id: PAT001
    birth_date: 1985-03-15
    sex: F
    studies:
      - description: Brain MRI Routine
        date: 2026-01-25
        accession: ACC00001
        institution: CHU Bordeaux
        department: Radiology
        body_part: HEAD
        referring_physician: DR SMITH^John
        series:
          - description: T1 SAG
            protocol: BRAIN_T1_SAG
            orientation: SAGITTAL
            images: 17
          - description: T2 AX
            protocol: BRAIN_T2_AX
            orientation: AXIAL
            images: 17
```

---

## Screen Designs

### Screen 1: Global Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DICOMFORGE WIZARD                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Modality:           [MR â–¼]                                     â”‚
â”‚  Total images:       [50      ]                                 â”‚
â”‚  Total size:         [500MB   ]                                 â”‚
â”‚  Output directory:   [dicom_series]                             â”‚
â”‚                                                                 â”‚
â”‚  Number of patients:    [1 ]                                    â”‚
â”‚  Studies per patient:   [1 ]                                    â”‚
â”‚  Series per study:      [1 ]                                    â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â„¹ï¸  MODALITY                                                     â”‚
â”‚                                                                 â”‚
â”‚ MR (Magnetic Resonance Imaging)                                 â”‚
â”‚ Used for brain, joints, soft tissues. Generates specific tags:  â”‚
â”‚ EchoTime, RepetitionTime, FlipAngle, MagneticFieldStrength.     â”‚
â”‚                                                                 â”‚
â”‚ Available: MR, CT, CR, DX, US, MG                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  [Tab] Next field  [Enter] Continue  [Esc] Cancel
```

### Screen 2: Patient Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PATIENT 1/3                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Patient name:    [DUPONT^Marie     ]  (generated default)      â”‚
â”‚  Patient ID:      [PAT001           ]                           â”‚
â”‚  Birth date:      [1985-03-15       ]                           â”‚
â”‚  Sex:             [F â–¼]                                         â”‚
â”‚                                                                 â”‚
â”‚  â˜ Accept defaults for all studies of this patient              â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â„¹ï¸  PATIENT NAME                                                 â”‚
â”‚                                                                 â”‚
â”‚ DICOM format: FAMILY^Given (e.g., SMITH^John)                   â”‚
â”‚ Special characters allowed: accents, apostrophes, hyphens.      â”‚
â”‚ Maximum 64 characters.                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Screen 3: Bulk Configuration Choice

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONFIGURE REMAINING PATIENTS                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  You have configured Patient 1. For the remaining 2 patients,   â”‚
â”‚  what would you like to do?                                     â”‚
â”‚                                                                 â”‚
â”‚  â— Generate automatically (random names/IDs)                    â”‚
â”‚  â—‹ Configure each one individually                              â”‚
â”‚  â—‹ Generate some, configure others                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Screen 4: Study Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PATIENT 1 â€” STUDY 1/2                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Study description:   [Brain MRI Routine    ]                   â”‚
â”‚  Study date:          [2026-01-25           ]                   â”‚
â”‚  Accession number:    [ACC00001             ]                   â”‚
â”‚  Referring physician: [DR SMITH^John        ]                   â”‚
â”‚  Institution:         [General Hospital     ]                   â”‚
â”‚  Department:          [Radiology            ]                   â”‚
â”‚  Body part:           [HEAD â–¼]                                  â”‚
â”‚  Priority:            [ROUTINE â–¼]                               â”‚
â”‚                                                                 â”‚
â”‚  â˜ Accept defaults for all series in this study                 â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â„¹ï¸  BODY PART                                                    â”‚
â”‚                                                                 â”‚
â”‚ Anatomical region examined. DICOM standard values:              â”‚
â”‚ HEAD, BRAIN, NECK, CHEST, ABDOMEN, PELVIS, SPINE, LSPINE,       â”‚
â”‚ KNEE, SHOULDER, HAND, FOOT...                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Screen 5: Series Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PATIENT 1 â€” STUDY 1 â€” SERIES 1/3                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Series description:  [T1 SAG              ]                    â”‚
â”‚  Protocol name:       [BRAIN_T1_SAG        ]                    â”‚
â”‚  Orientation:         [SAGITTAL â–¼]                              â”‚
â”‚  Images in series:    [17       ] (of 50 total)                 â”‚
â”‚                                                                 â”‚
â”‚  Custom tags:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ + Add custom tag                         â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â„¹ï¸  SERIES DESCRIPTION                                           â”‚
â”‚                                                                 â”‚
â”‚ Human-readable description of the acquisition sequence.         â”‚
â”‚ MR examples: T1 SAG, T2 AX, FLAIR COR, DWI, T1+C                â”‚
â”‚ CT examples: Without contrast, Arterial, Portal, Delayed        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Screen 6: Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GENERATION SUMMARY                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  PARAMETERS                          STRUCTURE                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚  Modality: MR                        ðŸ“ output/                 â”‚
â”‚  Total images: 50                    â”œâ”€â”€ ðŸ“ PT000000 (DUPONT)   â”‚
â”‚  Total size: 500MB                   â”‚   â”œâ”€â”€ ðŸ“ ST000000        â”‚
â”‚  Output: ./brain_study               â”‚   â”‚   â”œâ”€â”€ ðŸ“ SE000000    â”‚
â”‚                                      â”‚   â”‚   â”œâ”€â”€ ðŸ“ SE000001    â”‚
â”‚  Patients: 2                         â”‚   â”‚   â””â”€â”€ ðŸ“ SE000002    â”‚
â”‚  Studies: 2                          â”‚   â””â”€â”€ ðŸ“ ST000001        â”‚
â”‚  Series: 4                           â””â”€â”€ ðŸ“ PT000001 (MARTIN)   â”‚
â”‚  Custom tags: 3                                                 â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  EQUIVALENT CLI COMMAND                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  dicomforge --num-images 50 --total-size 500MB --modality MR \  â”‚
â”‚    --num-patients 2 --num-studies 2 --series-per-study 3 \      â”‚
â”‚    --output ./brain_study                          [Copy ðŸ“‹]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚         [â† Back]    [Generate]    [Save config]    [Cancel]     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Screen 7: Save Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SAVE CONFIGURATION?                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Would you like to save this configuration for future use?      â”‚
â”‚                                                                 â”‚
â”‚  â— Yes, save to file                                            â”‚
â”‚  â—‹ No, generate without saving                                  â”‚
â”‚                                                                 â”‚
â”‚  Filename: [brain_study.yaml    ]                               â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â„¹ï¸  CONFIGURATION FILE                                           â”‚
â”‚                                                                 â”‚
â”‚ Saves all wizard settings to a YAML file. Reuse later with:     â”‚
â”‚   dicomforge --config brain_study.yaml                          â”‚
â”‚                                                                 â”‚
â”‚ Useful for reproducibility, CI/CD, or sharing with your team.   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Screen 8: Progress

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GENERATING DICOM FILES                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                                                                 â”‚
â”‚     Generating...  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]  68%          â”‚
â”‚                                                                 â”‚
â”‚     34/50 files created                                         â”‚
â”‚                                                                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Screen 9: Completion

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ“ GENERATION COMPLETE                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  50 DICOM files created successfully                            â”‚
â”‚  Total size: 498.2 MB                                           â”‚
â”‚  Output directory: ./brain_study                                â”‚
â”‚                                                                 â”‚
â”‚  Next steps:                                                    â”‚
â”‚  â€¢ Import into your PACS: dcmsend localhost 4242 ./brain_study  â”‚
â”‚  â€¢ View with dcmdump: dcmdump ./brain_study/PT000000/.../IM0001 â”‚
â”‚  â€¢ Open in viewer: open ./brain_study (Horos, OsiriX, etc.)     â”‚
â”‚                                                                 â”‚
â”‚                          [Open folder]    [Exit]                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Help Descriptions

Each field needs contextual help. Store in `wizard/help/descriptions.go`:

```go
var HelpTexts = map[string]HelpText{
    "modality": {
        Title: "MODALITY",
        Description: "Imaging modality type.",
        Details: `MR (Magnetic Resonance) - Brain, joints, soft tissues
CT (Computed Tomography) - Cross-sectional X-ray imaging
CR (Computed Radiography) - Digital X-ray plates
DX (Digital X-Ray) - Direct digital radiography
US (Ultrasound) - Sound wave imaging
MG (Mammography) - Breast X-ray imaging`,
    },
    "patient_name": {
        Title: "PATIENT NAME",
        Description: "Patient name in DICOM format.",
        Details: `Format: FAMILY^Given (e.g., SMITH^John)
Special characters allowed: accents, apostrophes, hyphens
Maximum 64 characters
Examples: MÃœLLER^Hans, O'BRIEN^Mary, GARCIA-LOPEZ^JosÃ©`,
    },
    "body_part": {
        Title: "BODY PART",
        Description: "Anatomical region examined.",
        Details: `Standard DICOM values:
HEAD, BRAIN, NECK, CHEST, ABDOMEN, PELVIS
SPINE, CSPINE, TSPINE, LSPINE
SHOULDER, ELBOW, HAND, HIP, KNEE, ANKLE, FOOT`,
    },
    // ... more fields
}
```

---

## CLI Integration

### New Flags in main.go

```go
// Wizard mode
interactive := flag.Bool("interactive", false, "Launch interactive wizard")
flag.BoolVar(interactive, "i", false, "Launch interactive wizard (shortcut)")

// Config file support
configFile := flag.String("config", "", "Load configuration from YAML file")
saveConfig := flag.String("save-config", "", "Save configuration to YAML file")

// Wizard with existing config
wizardFrom := flag.String("from", "", "Start wizard with existing config file")
```

### Subcommand Detection

```go
if len(os.Args) > 1 && os.Args[1] == "wizard" {
    // Remove "wizard" from args and run wizard
    os.Args = append(os.Args[:1], os.Args[2:]...)
    wizard.Run(wizardFrom)
    return
}

if *interactive {
    wizard.Run(wizardFrom)
    return
}

if *configFile != "" {
    opts, err := config.LoadFromYAML(*configFile)
    // ... generate with opts
}
```

---

## Implementation Tasks

### Task 1: Add dependencies and basic wizard structure
- Add bubbletea, huh, lipgloss to go.mod
- Create wizard package structure
- Create WizardState and config structs

### Task 2: Implement config YAML load/save
- Create config.go with LoadFromYAML/SaveToYAML
- Add --config and --save-config flags to main.go
- Add wizard subcommand detection

### Task 3: Implement help panel component
- Create help_panel.go with HelpPanel model
- Create descriptions.go with all help texts
- Style with lipgloss

### Task 4: Implement global config screen
- Create screens/global.go
- Form fields: modality, images, size, output, patients, studies, series
- Integrate help panel

### Task 5: Implement patient config screen
- Create screens/patient.go
- Form fields: name, ID, birth date, sex
- "Accept defaults" checkbox
- Bulk configuration choice after first patient

### Task 6: Implement study config screen
- Create screens/study.go
- Form fields: description, date, accession, institution, department, body part, priority
- Custom tags sub-form

### Task 7: Implement series config screen
- Create screens/series.go
- Form fields: description, protocol, orientation, image count
- Custom tags sub-form

### Task 8: Implement summary screen
- Create screens/summary.go
- Parameter summary panel
- Tree view of structure
- CLI command equivalent with copy button
- Save config / Generate / Cancel buttons

### Task 9: Implement progress and completion screens
- Create screens/progress.go
- Simple progress bar
- Completion screen with next steps

### Task 10: Implement wizard orchestrator
- Create wizard.go main flow
- Screen navigation state machine
- Convert WizardState to GeneratorOptions
- Handle --from flag for loading existing config

### Task 11: Update documentation
- Add wizard section to README.md
- Add wizard examples to docs/EXAMPLES.md
- Create example config files in examples/configs/

### Task 12: Add tests
- Unit tests for config load/save
- Unit tests for state conversion
- Integration test for wizard flow (if feasible)

---

## Example Config Files

### examples/configs/simple_mr.yaml
```yaml
global:
  modality: MR
  total_images: 20
  total_size: 200MB
  output: ./simple_mr

patients:
  - name: SMITH^John
    id: PAT001
    birth_date: 1980-05-15
    sex: M
    studies:
      - description: Brain MRI
        body_part: HEAD
        series:
          - description: T1 SAG
            images: 10
          - description: T2 AX
            images: 10
```

### examples/configs/clinical_trial.yaml
```yaml
global:
  modality: MR
  total_images: 150
  total_size: 1GB
  output: ./clinical_trial
  seed: 2026

patients:
  - name: PATIENT^001
    id: TRIAL-001
    studies:
      - description: BASELINE
        date: 2026-01-01
      - description: WEEK_4
        date: 2026-01-29
      - description: WEEK_12
        date: 2026-03-26
```

---

## Documentation Updates

### README.md Addition

```markdown
## Interactive Wizard

For guided configuration with explanations, use the interactive wizard:

\`\`\`bash
# Launch the wizard
dicomforge wizard

# Or use the flag
dicomforge --interactive
dicomforge -i
\`\`\`

The wizard guides you through:
- Modality selection with explanations
- Patient/Study/Series configuration
- Custom DICOM tags with descriptions
- Real-time preview of the output structure

### Configuration Files

Save and reuse configurations:

\`\`\`bash
# Generate from a config file
dicomforge --config my_config.yaml

# Launch wizard with existing config as starting point
dicomforge wizard --from my_config.yaml

# Save current CLI options to config file
dicomforge --num-images 50 --modality MR --save-config my_config.yaml
\`\`\`

See [examples/configs/](examples/configs/) for sample configuration files.
```

---

## Verification

1. Run wizard: `go run ./cmd/dicomforge wizard`
2. Test each screen navigation
3. Save config and reload: `dicomforge --config test.yaml`
4. Verify generated DICOM files are valid: `dcmdump`
5. Run all tests: `go test ./...`
